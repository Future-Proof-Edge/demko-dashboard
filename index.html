<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <title>Demko Meta OS &mdash; Command Center</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        html { font-size: 125%; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8f7f4; min-height: 100vh; color: #1a1a1a;
        }

        /* TOAST */
        .toast {
            position: fixed; bottom: 2rem; left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1a1a1a; color: #fff;
            padding: 0.8rem 1.5rem; border-radius: 10px;
            font-size: 0.85rem; font-weight: 600; z-index: 999;
            opacity: 0; transition: all 0.3s ease; pointer-events: none;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* TOP BAR */
        .topbar {
            background: #fff; border-bottom: 1px solid #e8e5e0;
            padding: 1.2rem 2.5rem; display: flex; align-items: center;
            justify-content: space-between; position: sticky; top: 0; z-index: 100;
        }
        .topbar-left { display: flex; align-items: center; gap: 1rem; }
        .logo {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, #1a1a1a 0%, #444 100%);
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            color: #fff; font-weight: 900; font-size: 0.9rem;
        }
        .topbar h1 { font-size: 1.15rem; font-weight: 800; letter-spacing: -0.02em; }
        .topbar .session-tag {
            background: #f0eeeb; color: #888; padding: 0.3rem 0.8rem;
            border-radius: 6px; font-size: 0.72rem; font-weight: 600;
        }
        .topbar-right { display: flex; align-items: center; gap: 1.5rem; }
        .topbar-stat { text-align: center; }
        .topbar-stat .val { font-size: 1.4rem; font-weight: 800; line-height: 1; }
        .topbar-stat .lbl {
            font-size: 0.62rem; text-transform: uppercase;
            letter-spacing: 0.06em; color: #999; font-weight: 600;
        }
        .val-critical { color: #dc3545; }
        .val-pending { color: #e67e22; }
        .val-done { color: #27ae60; }
        .val-total { color: #1a1a1a; }
        .val-saved { color: #2563eb; }
        .topbar-divider { width: 1px; height: 28px; background: #e8e5e0; }

        /* SETTINGS GEAR */
        .settings-gear {
            width: 32px; height: 32px; border-radius: 8px; border: 1px solid #e8e5e0;
            background: #f0eeeb; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 1rem; transition: all 0.15s; color: #777;
        }
        .settings-gear:hover { background: #e8e5e0; }
        .settings-gear.connected { background: #edf8f0; border-color: #c3e6cb; color: #27ae60; }

        /* SETTINGS PANEL */
        .settings-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.3); z-index: 200;
        }
        .settings-overlay.open { display: flex; align-items: center; justify-content: center; }
        .settings-box {
            background: #fff; border-radius: 12px; padding: 1.5rem; width: 420px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        .settings-box h3 { font-size: 0.95rem; margin-bottom: 0.8rem; }
        .settings-box p { font-size: 0.75rem; color: #777; margin-bottom: 0.8rem; line-height: 1.5; }
        .settings-box input {
            width: 100%; padding: 0.5rem 0.8rem; border: 1px solid #e8e5e0;
            border-radius: 6px; font-size: 0.8rem; font-family: monospace;
        }
        .settings-box .btn-row { display: flex; gap: 0.5rem; margin-top: 1rem; }
        .settings-box button {
            padding: 0.4rem 1rem; border-radius: 6px; font-size: 0.75rem;
            font-weight: 700; cursor: pointer; font-family: 'Inter', sans-serif; border: none;
        }
        .btn-save { background: #1a1a1a; color: #fff; }
        .btn-save:hover { background: #333; }
        .btn-cancel { background: #f0eeeb; color: #777; }
        .btn-clear { background: #fdf0f0; color: #dc3545; }

        /* MAIN */
        .main { max-width: 1440px; margin: 0 auto; padding: 2rem 2.5rem 4rem; }

        /* BANNERS */
        .priority-banner {
            background: #fff; border: 1px solid #e8e5e0; border-left: 4px solid #dc3545;
            border-radius: 10px; padding: 1rem 1.5rem; margin-bottom: 1.5rem;
            display: flex; align-items: center; gap: 1rem;
        }
        .priority-banner .icon {
            width: 36px; height: 36px; background: #fdf0f0; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; font-weight: 800; color: #dc3545; flex-shrink: 0;
        }
        .priority-banner .text { font-size: 0.85rem; color: #555; line-height: 1.5; }
        .parallel-bar {
            background: #fff; border: 1px solid #e8e5e0; border-left: 4px solid #3498db;
            border-radius: 10px; padding: 0.8rem 1.5rem; margin-bottom: 2rem;
            display: flex; align-items: center; gap: 1rem; font-size: 0.82rem; color: #555;
        }
        .parallel-bar .icon {
            width: 36px; height: 36px; background: #edf4fc; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0;
        }
        .parallel-bar strong { color: #3498db; }

        /* SECTION HEADERS */
        .section-header {
            display: flex; align-items: center; gap: 0.6rem;
            margin-bottom: 1rem; margin-top: 0.5rem;
        }
        .section-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
        .dot-critical { background: #dc3545; }
        .dot-pending { background: #e67e22; }
        .dot-backlog { background: #aaa; }
        .dot-done { background: #27ae60; }
        .section-header h2 {
            font-size: 0.8rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.08em; color: #999;
        }
        .section-header .count-badge {
            background: #f0eeeb; color: #777; padding: 0.15rem 0.55rem;
            border-radius: 10px; font-size: 0.68rem; font-weight: 700;
        }
        .section-line { flex: 1; height: 1px; background: #e8e5e0; }

        /* CARD GRID */
        .card-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 0.9rem; margin-bottom: 2.5rem;
        }

        /* CARDS */
        .card {
            background: #fff; border: 1px solid #e8e5e0; border-radius: 10px;
            padding: 1.1rem 1.2rem; transition: all 0.15s ease;
            position: relative; overflow: visible;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0;
            width: 3px; height: 100%; border-radius: 3px 0 0 3px;
        }
        .card:hover { border-color: #ccc; box-shadow: 0 4px 20px rgba(0,0,0,0.06); transform: translateY(-1px); }
        .card-critical::before { background: #dc3545; }
        .card-high::before { background: #e67e22; }
        .card-medium::before { background: #3498db; }
        .card-low::before { background: #ccc; }
        .card-done { opacity: 0.7; }
        .card-done .unlocked-chain { opacity: 1; }
        .card-done::before { background: #27ae60; }
        .card-done h3 { text-decoration: line-through; color: #888; }

        .card-top { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 0.5rem; }
        .card h3 { font-size: 0.88rem; font-weight: 700; line-height: 1.3; letter-spacing: -0.01em; padding-left: 0.6rem; }
        .card-chips { display: flex; gap: 0.4rem; flex-shrink: 0; align-items: center; }

        .priority-chip {
            padding: 0.15rem 0.5rem; border-radius: 5px; font-size: 0.58rem;
            font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; white-space: nowrap;
        }
        .chip-critical { background: #fdf0f0; color: #dc3545; }
        .chip-high { background: #fef5ec; color: #e67e22; }
        .chip-medium { background: #edf4fc; color: #3498db; }
        .chip-low { background: #f5f5f5; color: #999; }
        .chip-done { background: #edf8f0; color: #27ae60; }

        .time-chip {
            padding: 0.15rem 0.5rem; border-radius: 5px; font-size: 0.58rem;
            font-weight: 700; background: #f0eeeb; color: #777; white-space: nowrap;
        }
        .overnight-badge {
            display: inline-flex; align-items: center; gap: 0.3rem;
            background: linear-gradient(135deg, #1a1a3e 0%, #2d1b69 100%);
            color: #e0d4ff; padding: 0.2rem 0.6rem; border-radius: 5px;
            font-size: 0.58rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.04em; white-space: nowrap;
        }
        .time-saved {
            display: inline-flex; align-items: center; gap: 0.25rem;
            background: #edf8f0; color: #27ae60; padding: 0.2rem 0.6rem;
            border-radius: 5px; font-size: 0.58rem; font-weight: 700; white-space: nowrap;
        }
        .card-desc {
            font-size: 0.78rem; color: #777; line-height: 1.55;
            padding-left: 0.6rem; margin-bottom: 0.7rem;
        }
        .card-footer {
            display: flex; justify-content: space-between; align-items: center; padding-left: 0.6rem;
        }
        .card-tags { display: flex; gap: 0.35rem; flex-wrap: wrap; }
        .tag {
            padding: 0.18rem 0.55rem; border-radius: 5px; font-size: 0.6rem;
            font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em;
        }
        .tag-protocol { background: #f5f0f8; color: #8e44ad; }
        .tag-setup { background: #edf8f0; color: #27ae60; }
        .tag-build { background: #edf0f8; color: #2c3e9e; }
        .tag-infra { background: #fdf8ed; color: #b8860b; }
        .tag-cleanup { background: #edf5f5; color: #16a085; }

        .unlocked-chain {
            display: flex; flex-wrap: wrap; gap: 0.3rem;
            padding: 0.4rem 0.6rem 0; margin-top: 0.3rem; border-top: 1px dashed #e8e5e0;
        }
        .chain-arrow {
            display: inline-flex; align-items: center; gap: 0.25rem;
            font-size: 0.65rem; font-weight: 700; color: #1e8449;
            background: #e8f8ee; padding: 0.18rem 0.55rem; border-radius: 5px;
            white-space: nowrap; border: 1px solid #c3e6cb;
        }

        /* COMPLETE BUTTON */
        .complete-btn {
            background: #27ae60; color: #fff; border: none;
            padding: 0.4rem 0.9rem; border-radius: 6px; font-size: 0.7rem;
            font-weight: 700; cursor: pointer; transition: all 0.15s;
            display: flex; align-items: center; gap: 0.35rem; white-space: nowrap;
            font-family: 'Inter', sans-serif;
        }
        .complete-btn:hover { background: #219a52; transform: scale(1.03); }
        .complete-btn:active { transform: scale(0.97); }

        .launch-btn {
            background: #1a1a1a; color: #fff; border: none;
            padding: 0.4rem 0.9rem; border-radius: 6px; font-size: 0.7rem;
            font-weight: 700; cursor: pointer; transition: all 0.15s;
            display: flex; align-items: center; gap: 0.35rem; white-space: nowrap;
            font-family: 'Inter', sans-serif;
        }
        .launch-btn:hover { background: #333; transform: scale(1.03); }
        .launch-btn.launched { background: #27ae60; }

        .needs-user {
            background: #f0eeeb; color: #999; border: 1px dashed #ddd;
            padding: 0.35rem 0.8rem; border-radius: 6px; font-size: 0.65rem;
            font-weight: 600; white-space: nowrap; font-family: 'Inter', sans-serif;
        }

        /* COMPLETE MODAL */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4); z-index: 300;
            align-items: center; justify-content: center;
        }
        .modal-overlay.open { display: flex; }
        .modal-box {
            background: #fff; border-radius: 12px; padding: 1.5rem; width: 380px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        .modal-box h3 { font-size: 0.95rem; margin-bottom: 0.3rem; }
        .modal-box .modal-subtitle { font-size: 0.75rem; color: #777; margin-bottom: 1rem; }
        .modal-box label { font-size: 0.72rem; font-weight: 600; color: #555; display: block; margin-bottom: 0.3rem; }
        .hours-presets { display: flex; gap: 0.4rem; margin-bottom: 1rem; }
        .hours-presets button {
            padding: 0.35rem 0.8rem; border-radius: 6px; border: 1px solid #e8e5e0;
            background: #f8f7f4; font-size: 0.75rem; font-weight: 700; cursor: pointer;
            font-family: 'Inter', sans-serif; transition: all 0.1s;
        }
        .hours-presets button:hover { background: #e8e5e0; }
        .hours-presets button.selected { background: #2563eb; color: #fff; border-color: #2563eb; }
        .modal-box input[type="number"] {
            width: 100%; padding: 0.5rem 0.8rem; border: 1px solid #e8e5e0;
            border-radius: 6px; font-size: 0.85rem; font-family: 'Inter', sans-serif;
        }
        .modal-actions { display: flex; gap: 0.5rem; margin-top: 1.2rem; }
        .modal-actions button {
            flex: 1; padding: 0.5rem; border-radius: 6px; font-size: 0.8rem;
            font-weight: 700; cursor: pointer; font-family: 'Inter', sans-serif; border: none;
        }
        .modal-confirm { background: #27ae60; color: #fff; }
        .modal-confirm:hover { background: #219a52; }
        .modal-cancel-btn { background: #f0eeeb; color: #777; }

        /* LEADERBOARD */
        .toggle-btn {
            background: #f0eeeb; border: 1px solid #e8e5e0;
            padding: 0.2rem 0.7rem; border-radius: 6px; font-size: 0.6rem;
            font-weight: 700; color: #777; cursor: pointer; transition: all 0.15s;
            font-family: 'Inter', sans-serif; text-transform: uppercase; letter-spacing: 0.04em;
            margin-left: 0.5rem;
        }
        .toggle-btn:hover { background: #e8e5e0; }
        .toggle-btn.active { background: #2563eb; color: #fff; border-color: #2563eb; }
        .leaderboard-rank {
            position: absolute; top: 0.5rem; right: 0.5rem;
            background: #2563eb; color: #fff; width: 28px; height: 28px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 0.6rem; font-weight: 800; z-index: 2;
        }

        /* CARD COMPLETE ANIMATION */
        .card.completing {
            animation: completeFlash 0.6s ease;
        }
        @keyframes completeFlash {
            0% { background: #fff; }
            30% { background: #e8f8ee; border-color: #27ae60; }
            100% { background: #fff; }
        }

        /* SEARCH BAR */
        .search-bar {
            margin-bottom: 1.5rem; position: relative;
        }
        .search-bar input {
            width: 100%; padding: 0.6rem 1rem 0.6rem 2.4rem;
            border: 1px solid #e8e5e0; border-radius: 8px;
            font-size: 0.82rem; font-family: 'Inter', sans-serif;
            background: #fff; color: #1a1a1a; outline: none;
            transition: border-color 0.15s;
        }
        .search-bar input:focus { border-color: #2563eb; }
        .search-bar input::placeholder { color: #bbb; }
        .search-bar .search-icon {
            position: absolute; left: 0.8rem; top: 50%; transform: translateY(-50%);
            font-size: 0.85rem; color: #bbb; pointer-events: none;
        }
        .search-bar .search-clear {
            position: absolute; right: 0.6rem; top: 50%; transform: translateY(-50%);
            background: none; border: none; font-size: 1rem; color: #bbb;
            cursor: pointer; display: none; font-family: 'Inter', sans-serif;
        }
        .search-bar .search-clear.visible { display: block; }
        .card.search-hidden { display: none; }
        .section-header.search-hidden { display: none; }

        /* DESC TRUNCATION */
        .card-desc { max-height: 3.2em; overflow: hidden; transition: max-height 0.25s ease; }
        .card-desc.expanded { max-height: none; }
        .show-more {
            padding-left: 0.6rem; font-size: 0.68rem; color: #2563eb;
            cursor: pointer; font-weight: 600; margin-bottom: 0.5rem;
            display: none; background: none; border: none;
            font-family: 'Inter', sans-serif;
        }
        .show-more.visible { display: block; }

        /* DONE COLLAPSE */
        .done-collapsed { display: none; }
        .done-collapsed.show-all { display: block; }
        .done-expander {
            display: block; width: 100%; padding: 0.6rem; margin-bottom: 2.5rem;
            background: #f0eeeb; border: 1px dashed #ddd; border-radius: 8px;
            font-size: 0.75rem; font-weight: 700; color: #777; cursor: pointer;
            font-family: 'Inter', sans-serif; text-align: center; transition: all 0.15s;
        }
        .done-expander:hover { background: #e8e5e0; color: #555; }

        /* FOOTER */
        .footer {
            text-align: center; padding: 2rem 0 1rem; color: #bbb;
            font-size: 0.72rem; font-weight: 500;
        }
        .footer span { background: #f0eeeb; padding: 0.3rem 0.8rem; border-radius: 6px; }

        /* LOADING STATE */
        .loading-bar {
            height: 3px; background: #2563eb; position: fixed; top: 0; left: 0;
            z-index: 999; transition: width 0.3s; border-radius: 0 2px 2px 0;
        }

        @media (max-width: 768px) {
            .topbar { padding: 1rem; flex-direction: column; gap: 1rem; }
            .main { padding: 1.5rem 1rem; }
            .card-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div id="loading-bar" class="loading-bar" style="width:30%"></div>
<div id="toast" class="toast"></div>

<!-- SETTINGS MODAL -->
<div id="settings-overlay" class="settings-overlay">
    <div class="settings-box">
        <h3>GitHub Connection</h3>
        <p>Enter a GitHub Personal Access Token (with <code>repo</code> scope) to enable completing tasks from this dashboard. The token is stored only in your browser's localStorage.</p>
        <input type="password" id="pat-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
        <div class="btn-row">
            <button class="btn-save" onclick="savePAT()">Save</button>
            <button class="btn-clear" onclick="clearPAT()">Clear Token</button>
            <button class="btn-cancel" onclick="closeSettings()">Cancel</button>
        </div>
    </div>
</div>

<!-- COMPLETE TASK MODAL -->
<div id="complete-overlay" class="modal-overlay">
    <div class="modal-box">
        <h3 id="complete-modal-title">Complete Task</h3>
        <div class="modal-subtitle" id="complete-modal-subtitle"></div>
        <label>Hours this task saved you:</label>
        <div class="hours-presets" id="hours-presets">
            <button onclick="selectHours(0.5)">0.5h</button>
            <button onclick="selectHours(1)">1h</button>
            <button onclick="selectHours(2)">2h</button>
            <button onclick="selectHours(4)">4h</button>
            <button onclick="selectHours(8)">8h</button>
        </div>
        <input type="number" id="hours-input" min="0" step="0.5" value="1" placeholder="Custom hours">
        <div class="modal-actions">
            <button class="modal-confirm" onclick="confirmComplete()">&#10003; Mark Done</button>
            <button class="modal-cancel-btn" onclick="closeCompleteModal()">Cancel</button>
        </div>
    </div>
</div>

<div id="app"></div>

<script>
// â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var GITHUB_OWNER = 'Future-Proof-Edge';
var GITHUB_REPO = 'Demko-Meta-OS-2';
var GITHUB_PATH = 'kanban_data.json';
var GITHUB_BRANCH = 'master';
var EMBEDDED_DATA = {
  "meta": {
    "title": "Demko Meta OS",
    "session_tag": "Feb 13-16, 2026 â€” Updated Feb 17 priorities",
    "hourly_rate": 250,
    "last_updated": "Feb 17, 2026",
    "ci_status": "Green"
  },
  "banners": {
    "priority": "ðŸš¨ Feb 17 TOP PRIORITY: Configure MCP API keys (Firecrawl, Brave, Perplexity) + curate top 10 Twitter builder handles for Frontier Signals Pipeline. 20 min total. Unlocks Layer 1 intelligence.",
    "parallel": "Run up to 5 tasks in parallel on claude.ai. Click â€œLaunchâ€ to copy the task prompt and open a new Claude tab. Paste (Ctrl+V) and hit Enter. Each runs independently."
  },
  "columns": [
    {
      "id": "critical",
      "label": "Critical - Do Now",
      "dot": "dot-critical"
    },
    {
      "id": "pending",
      "label": "Pending - Next Up",
      "dot": "dot-pending"
    },
    {
      "id": "backlog",
      "label": "Backlog - Later",
      "dot": "dot-backlog"
    },
    {
      "id": "done",
      "label": "Done",
      "dot": "dot-done"
    }
  ],
  "cards": [
    {
      "id": "wispr-flow-optimization",
      "title": "Wispr Flow Deep Dive & Mic Lock Fix",
      "description": "Full audit of Wispr Flow voice dictation: Ctrl+Space conflict check (clean), system resource check (clean), config.json diagnostic analysis revealing 38 mic switches â†’ 96 cancelled transcripts â†’ 64 paste failures. Root cause: overrideAudioDeviceId set to dynamic 'communications' instead of specific device. Fix: locked to Blue Snowball device hash. Drafted feedback for Wispr Flow team (email, X, roadmap). Feb 17.",
      "column": "done",
      "priority": "done",
      "hours_saved": 1.5,
      "time_estimate": null,
      "tags": [
        "tool-config",
        "debugging"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "dashboard-deploy-sync",
      "title": "Dashboard Deploy Sync Protocol",
      "description": "Cloned demko-dashboard deploy repo, synced kanban_dashboard.html â†’ index.html, pushed to GitHub Pages. Fixed stale deploy missing Done-on-top layout, leaderboard toggle, chain arrows, and scoring badges. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 0.5,
      "time_estimate": null,
      "tags": [
        "infra",
        "protocol"
      ],
      "overnight": false,
      "chains": [
        "All future dashboard deploys"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "3d-scoring-framework",
      "title": "3D Scoring Framework",
      "description": "Replaced simple impact/effort ROI with Amplification Ã— Creative / Effort in meta_learning_loop.py. New dimensions: Amplification (1-10, downstream outputs affected), Creative (1-10, novel thinking vs mechanical). Updated dataclass, Stage 2 prompt, output formatting, and memory capture. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 0.5,
      "time_estimate": null,
      "tags": [
        "build"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "e2e-stress-test",
      "title": "End-to-End Stress Test",
      "description": "Full pipeline validated: /ci-swarm (6 competitors, 87KB report) â†’ strategic-reviewer CUV audit (3 rounds, 6.6â†’9.0/10) â†’ hooks verified (audit logger, file protection, session context). Found & fixed 2 gaps: wired CUV Stop Gate + Anti-Rationalization Gate into Stop hooks. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 6,
      "time_estimate": null,
      "tags": [
        "build",
        "protocol"
      ],
      "overnight": false,
      "chains": [
        "3D Scoring Framework"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "flo-health-instructions",
      "title": "Write Flo Health Project Instructions",
      "description": "CLAUDE_FloHealth.md â€” full board intelligence playbook derived from 7 corpus files. Competitor table, 6 strategic themes, Synthetic Council config, artifact standards, demo readiness checklist. Built autonomously while user was away. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 4,
      "time_estimate": null,
      "tags": [
        "protocol"
      ],
      "overnight": true,
      "chains": [],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "eod-handoff-protocol",
      "title": "End-of-Day Handoff Protocol",
      "description": "HANDOFF_PROTOCOL.md â€” task block template, model selection guide, P1-P5 priority ranking, context payload guide, morning verification checklist, sample Flo CI sweep, anti-patterns. Built by parallel agent. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 2,
      "time_estimate": null,
      "tags": [
        "protocol"
      ],
      "overnight": true,
      "chains": [],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "tighten-kill-filter",
      "title": "Tighten Kill Filter Prompts",
      "description": "3 fixes in extract_recording_feedback.py: cross-claim deduplication (Kill 1), 16h effort ceiling hard gate (Kill 4), metrics-as-features bug with regex safety net. 34 false BUILD candidates â†’ 7 real ones. Built by parallel agent. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 3,
      "time_estimate": null,
      "tags": [
        "build"
      ],
      "overnight": true,
      "chains": [],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "p0-hooks-layer",
      "title": "P0 â€” Hooks Layer (Deterministic Enforcement)",
      "description": "CUV Stop Gate, Audit Logger, File Protection, Anti-Rationalization Gate, Session Context Injection, PreCompact Backup, Windows Notification. All 7 hooks wired in settings.local.json. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 8,
      "time_estimate": null,
      "tags": [
        "infra",
        "protocol"
      ],
      "overnight": false,
      "chains": [
        "Stress Test",
        "CLAUDE.md Fix"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "p1-skills-layer",
      "title": "P1 â€” Skills Layer (One-Command Workflows)",
      "description": "/ci-swarm, /red-team, /strategic-brief, /recording-feedback, /session-close â€” 5 skills in .claude/skills/. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 4,
      "time_estimate": null,
      "tags": [
        "build"
      ],
      "overnight": false,
      "chains": [
        "Stress Test"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "p3-context-management",
      "title": "P3 â€” Context Management (Compaction Survival)",
      "description": "PreCompact backup hook, SessionStart reload, auto-compact at 50%, bash output cap, compaction directives in CLAUDE.md. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 3,
      "time_estimate": null,
      "tags": [
        "infra"
      ],
      "overnight": false,
      "chains": [
        "Overnight autonomous work"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "p4-custom-subagents",
      "title": "P4 â€” Custom Subagents (4 Specialized Agents)",
      "description": "ci-researcher (haiku), strategic-reviewer (sonnet), doc-fixer (haiku), codebase-auditor (haiku) in .claude/agents/. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 3,
      "time_estimate": null,
      "tags": [
        "build"
      ],
      "overnight": false,
      "chains": [
        "Flo Health Instructions",
        "Handoff Protocol",
        "Kill Filter",
        "Stress Test"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "ci-header-validation",
      "title": "CI Header Validation Fix",
      "description": "Batch-fixed 15 legacy artifacts missing Canonical_Location, Artifact_Owner, Modification_Policy, Status fields. CI now green. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 2,
      "time_estimate": null,
      "tags": [
        "cleanup"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "fix-claude-md",
      "title": "Fix CLAUDE.md Protocol Contradictions",
      "description": "Fixed 3 red team findings: pre-flight gate opt-out consolidation, recursive lessons circular dep (exempt autonomous actions), SESSION_AUDIT collision (session ID in filename). Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 1.5,
      "time_estimate": null,
      "tags": [
        "protocol"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "organize-root-dir",
      "title": "Organize Root Directory",
      "description": "222 files â†’ organized into ci_reports/, transcripts/, media/, red_team_results/, session_logs/, recording_feedback/. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 3,
      "time_estimate": null,
      "tags": [
        "cleanup"
      ],
      "overnight": false,
      "chains": [
        "CI Header Fix"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "deploy-identity-rules",
      "title": "Deploy Identity Rules to Claude.ai",
      "description": "Automated via deploy_claude_profile.py. Profile + Project Instructions deployed to claude.ai. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 2,
      "time_estimate": null,
      "tags": [
        "protocol"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "github-cli-auth",
      "title": "Complete GitHub CLI Auth",
      "description": "gh in PATH, git push working, branch synced to origin/master. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 0.5,
      "time_estimate": null,
      "tags": [
        "setup"
      ],
      "overnight": false,
      "chains": [
        "All deployments"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "notebooklm-transcript-loop",
      "title": "NotebookLM Transcript Loop",
      "description": "notebooklm_loop.py â€” single command: download â†’ compress â†’ transcribe â†’ extract â†’ red team. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 5,
      "time_estimate": null,
      "tags": [
        "build"
      ],
      "overnight": false,
      "chains": [
        "Kill Filter Prompts"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "profile-sync-automation",
      "title": "Profile Sync Automation",
      "description": "deploy_claude_profile.py â€” Playwright Edge automation deploys CLAUDE_AI_PROFILE_INSTRUCTIONS.md to claude.ai. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 3,
      "time_estimate": null,
      "tags": [
        "build"
      ],
      "overnight": false,
      "chains": [
        "Deploy Identity Rules"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "understand-claude-v18-evolution",
      "title": "P0 â€” Understand CLAUDE.md v1.6â†’v1.8 Evolution",
      "description": "Another session evolved CLAUDE.md through 3 versions (v1.6â†’v1.7â†’v1.8) with major changes you haven't reviewed yet. Key changes: (1) CUV restructured from 5-item checklist to 4-dimension + frontier retro-check lens model, (2) Frontier Whisper added for TIER 1 â€” passive frontier awareness on tactical tasks, (3) CRITIQUE_FRAMEWORK.md created with full convergence criteria, (4) FRONTIER_SIGNALS.md referenced as evidence source, (5) 47-finding red team (4 models) drove v1.8. Files to review: INTELLIGENCE_DELTA.md (full changelog), CLAUDE.md Rule 3 (CUV), CLAUDE.md Rule 4 (Frontier Whisper), CRITIQUE_FRAMEWORK.md. Feb 16.",
      "column": "critical",
      "priority": "critical",
      "hours_saved": null,
      "time_estimate": "~30 min review",
      "tags": [
        "protocol",
        "review"
      ],
      "overnight": false,
      "chains": [
        "Build in Public CUV Upgrades",
        "Frontier Signals Pipeline"
      ],
      "needs_user": "Your understanding required â€” foundational changes",
      "launch_prompt": null
    },
    {
      "id": "configure-mcp-api-keys",
      "title": "Configure MCP API Keys",
      "description": "Firecrawl, Brave Search, Perplexity â€” none in .env yet. Required for Layer 1 intelligence scraping pipeline.",
      "column": "critical",
      "priority": "critical",
      "hours_saved": null,
      "time_estimate": "~20 min",
      "tags": [
        "setup",
        "infra"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": "Needs your accounts",
      "launch_prompt": null
    },
    {
      "id": "install-agent-sdk-plugin",
      "title": "Install Agent SDK Dev Plugin",
      "description": "Directly relevant to multi-agent architecture. Available in Desktop plugin browser. Click Plugins in sidebar, find Agent SDK dev, install.",
      "column": "critical",
      "priority": "high",
      "hours_saved": null,
      "time_estimate": "~1 min",
      "tags": [
        "setup"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": "Desktop UI click",
      "launch_prompt": null
    },
    {
      "id": "install-chrome-extension",
      "title": "Install Claude in Chrome Extension",
      "description": "Use work/separate Chrome profile â€” NOT personal account. Enables browser automation from Claude Code.",
      "column": "critical",
      "priority": "high",
      "hours_saved": null,
      "time_estimate": "~2 min",
      "tags": [
        "setup"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": "Chrome UI click",
      "launch_prompt": null
    },
    {
      "id": "gcp-domain-delegation",
      "title": "GCP Domain-Wide Delegation",
      "description": "Enables Google Drive browsing and searching. Currently limited to reading by direct Doc ID only.",
      "column": "pending",
      "priority": "medium",
      "hours_saved": null,
      "time_estimate": "~15 min",
      "tags": [
        "infra"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": "Needs GCP Admin Console",
      "launch_prompt": null
    },
    {
      "id": "frontier-signals-pipeline",
      "title": "Frontier Signals Pipeline (Twitter/X)",
      "description": "Weekly batch: scrape/summarize top 10 builders' Twitter/X feeds â†’ FRONTIER_SIGNALS.md. Referenced during CUV dim 5 retro-check and Frontier Whisper. Solves training-data staleness (red team Theme 4). Uses existing GROK_API_KEY for X API. Integrate into Friday CI Swarm schedule. Output: structured artifact with signals clustered by theme (AI agents, prompt eng, meta-cognitive systems).",
      "column": "pending",
      "priority": "high",
      "hours_saved": null,
      "time_estimate": "~2h build",
      "tags": [
        "build",
        "infra"
      ],
      "overnight": false,
      "chains": [
        "CUV v1.8 frontier retro-check"
      ],
      "needs_user": "Curate top 10 builder list",
      "launch_prompt": "Build frontier_signals.py in C:\\Demko_Local_Project\\Demko Meta OS 2. It should: 1) Read a curated list of Twitter/X accounts from frontier_builders.txt (one handle per line), 2) Use GROK_API_KEY to fetch recent tweets (last 7 days) from each account, 3) Filter for signal (technical insights, tool announcements, pattern shifts) vs noise (personal, promotional), 4) Cluster signals by theme, 5) Output FRONTIER_SIGNALS.md with structured format: ## Theme > - Signal: [Builder] observation > - Source: tweet URL. 6) Integrate into run_weekly_ci.bat to run alongside CI Swarm on Fridays. Graceful degradation if GROK_API_KEY missing."
    },
    {
      "id": "x-engagement-tracker",
      "title": "X Engagement Tracker â€” Polish & Ship",
      "description": "Phase 1-2 complete: engagement_tracker.py, render_engagement.py, influencer_watchlist.json all working. --demo produces 8-tweet dashboard with sparklines, influencer grid, and growth charts. TODO: user feedback pass, test --fetch with live API, --init-watchlist to resolve user IDs, deploy dashboard to GitHub Pages. Feb 16.",
      "column": "pending",
      "priority": "low",
      "hours_saved": null,
      "time_estimate": "~1h",
      "tags": [
        "build"
      ],
      "overnight": false,
      "chains": [
        "Frontier Signals Pipeline"
      ],
      "needs_user": "Visual feedback on dashboard",
      "launch_prompt": null
    },
    {
      "id": "auto-ingest-system",
      "title": "Auto-Ingest System",
      "description": "auto_ingest.py â€” reads accretive report, copies INGEST files to knowledge corpus automatically.",
      "column": "backlog",
      "priority": "low",
      "hours_saved": null,
      "time_estimate": "~20 min",
      "tags": [
        "build"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": null,
      "launch_prompt": "Build auto_ingest.py in C:\\Demko_Local_Project\\Demko Meta OS 2. It should: 1) Read the latest accretive_evaluation_report.json, 2) Find items tagged for INGEST, 3) Copy them into the knowledge corpus (used by knowledge_corpus_rag.py), 4) Update knowledge_corpus_index.json. Follow the INGEST_PIPELINE_CONTRACT__v1.0.md for artifact standards. Test by running it against the current accretive report."
    },
    {
      "id": "mobile-capture-pipeline",
      "title": "Mobile Capture Pipeline",
      "description": "End-to-end test: Pixel 9a â†’ Google Recorder â†’ Drive â†’ Claude Code ingestion.",
      "column": "backlog",
      "priority": "low",
      "hours_saved": null,
      "time_estimate": "~30 min",
      "tags": [
        "infra"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": "Needs phone + Drive",
      "launch_prompt": null
    },
    {
      "id": "interactive-dashboard-rewrite",
      "title": "Interactive Dashboard Rewrite",
      "description": "Complete architectural rewrite of Kanban dashboard. Eliminated fragile 4-step pipeline (edit JSON â†’ python render â†’ copy repo â†’ git push). New version: client-side JS rendering, live GitHub API fetch on load (no more stale cache), clickable Done buttons with hours-saved modal, GitHub API persistence via PAT. One deploy, then all updates happen from the dashboard itself. Feb 16.",
      "column": "done",
      "priority": "done",
      "hours_saved": 2,
      "time_estimate": null,
      "tags": [
        "build",
        "infra"
      ],
      "overnight": false,
      "chains": [
        "All future dashboard updates"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "build-in-public-flywheel",
      "title": "Build in Public Content Flywheel â€” CUV Upgrades",
      "description": "Core flywheel working (commits â†’ themes â†’ blog posts â†’ tweet storm). CUV 1.8 identified 5 upgrades from 1% builder research: U1 Engagement window reminder, U2 Constellation format (standalone + quote-tweets instead of long threads), U3 Metrics injection (streak counter, day number, time-saved stats), U4 Engagement hit list (post-tweet reply targets), U5 Blog index page + navigation. Need to review, bless, and implement.",
      "column": "pending",
      "priority": "high",
      "hours_saved": null,
      "time_estimate": null,
      "tags": [
        "build",
        "content"
      ],
      "overnight": false,
      "chains": [
        "X Engagement Tracker",
        "Frontier Signals Pipeline"
      ],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "origin-story-narrative",
      "title": "Plan & Write Origin Story Narrative",
      "description": "Life hacker â†’ factory architect story. 7-act arc planned: (1) The Addiction â€” 15yr friction-killing pattern, (2) Copywriting Lineage â€” Ogilvy, Kennedy, Schwartz, Hormozi, (3) The Kyle Moment â€” zero fracking knowledge â†’ $12M pitch, (4) Human Router Problem â€” copy-paste between AI tools, (5) Claude Code Arrives â€” 90/10 flip, (6) Factory Takes Shape â€” Meta OS with adversarial truth, CUV, 3 surfaces, multi-model red team, (7) Infinite Leverage Thesis â€” 1% compounding, READ-WRITE 100x. Weave in influence_list.md (30+ names). All source material gathered and reviewed. Ready to write.",
      "column": "pending",
      "priority": "medium",
      "hours_saved": null,
      "time_estimate": "~2h",
      "tags": [
        "content",
        "narrative"
      ],
      "overnight": false,
      "chains": [
        "Build in Public Flywheel"
      ],
      "needs_user": "Choose format: blog post, presentation, NotebookLM source, or Twitter thread",
      "launch_prompt": null
    },
    {
      "id": "done-section-collapse",
      "title": "Collapse Done Section (Show Recent 10)",
      "description": "Done section shows only the 10 most recent completed cards by default. 'Show N more' expander button reveals the rest. Feb 17.",
      "column": "done",
      "priority": "done",
      "hours_saved": 0.5,
      "time_estimate": null,
      "tags": [
        "build"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": null,
      "launch_prompt": "In C:\\Demko_Local_Project\\Demko Meta OS 2\\render_dashboard.py, modify the client-side JS render() function so the Done section only shows the 10 most recent cards initially. Add a 'Show N more' expander button below the visible cards that reveals the rest when clicked. Sort done cards by most recently completed (use card array order as proxy â€” newest cards are appended last). Style the expander to match existing dashboard aesthetics."
    },
    {
      "id": "build-in-public-autopost",
      "title": "Build in Public â€” Daily Auto-Post to X",
      "description": "Full implementation: build_in_public.py (git log â†’ AI draft â†’ Tweepy post â†’ archive), .env with X API keys, pip install deps, Windows Scheduled Task at 6 PM daily. Posts to @futureproofedge. Needs X Developer account created first. Feb 16.",
      "column": "pending",
      "priority": "high",
      "hours_saved": null,
      "time_estimate": "~1h",
      "tags": [
        "build",
        "content"
      ],
      "overnight": false,
      "chains": [
        "Build in Public Flywheel",
        "X Engagement Tracker"
      ],
      "needs_user": "Create X Developer account at developer.x.com, get 4 API keys",
      "launch_prompt": "Implement the Build in Public daily auto-post system in C:\\Demko_Local_Project\\Demko Meta OS 2. Create build_in_public.py that: 1) Runs git log --since=midnight --oneline on the Demko repo, 2) Skips if no commits, 3) Sends commit messages to OpenAI API to draft a layperson-friendly tweet (â‰¤280 chars) emphasizing time saved/cool factor with #BuildInPublic, 4) Posts via Tweepy client.create_tweet(), 5) Appends to tweet_archive.md. Also: create .env with X API key placeholders, pip install tweepy python-dotenv openai, create Windows Scheduled Task for 6 PM daily, test end-to-end."
    },
    {
      "id": "openrouter-evaluation",
      "title": "Evaluate OpenRouter as Unified API Layer",
      "description": "Research whether OpenRouter (1% markup, 200+ models, OpenAI-compatible, caching, auto-fallback) makes sense as a routing layer on top of existing direct API keys (Anthropic, OpenAI, DeepSeek, Poe, Gemini). Would unify billing, add failover, and simplify red_team_review.py multi-model calls. Compare: current direct-to-provider cost vs OpenRouter markup. Low priority â€” costs aren't a concern, this is an optimization play.",
      "column": "backlog",
      "priority": "low",
      "hours_saved": null,
      "time_estimate": "~1h",
      "tags": [
        "infra",
        "research"
      ],
      "overnight": false,
      "chains": [],
      "needs_user": null,
      "launch_prompt": null
    },
    {
      "id": "launch-claude-code-cli",
      "title": "Launch Button â†’ Claude Code CLI",
      "description": "Protocol handler registered (claude-code:// in HKCU registry, claude-code-launcher.bat). Dashboard launchTask() updated to fire claude-code://launch?prompt=... URL. Needs testing: click Launch on a card, confirm browser prompts 'Allow?', confirm Windows Terminal opens with claude -p running. If bat fails on long/special-char prompts, switch to temp-file approach. Feb 16.",
      "column": "pending",
      "priority": "high",
      "hours_saved": null,
      "time_estimate": "~20 min",
      "tags": [
        "build"
      ],
      "overnight": false,
      "chains": [
        "All launch_prompt cards"
      ],
      "needs_user": "Test in browser",
      "launch_prompt": null
    }
  ]
};

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var kanbanData = null;
var fileSha = null;
var completingCardId = null;
var leaderboardActive = false;

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function init() {
    setLoading(30);
    try {
        var resp = await fetch(
            'https://api.github.com/repos/' + GITHUB_OWNER + '/' + GITHUB_REPO +
            '/contents/' + GITHUB_PATH + '?ref=' + GITHUB_BRANCH + '&t=' + Date.now(),
            { headers: getAuthHeaders() }
        );
        if (resp.ok) {
            var json = await resp.json();
            fileSha = json.sha;
            kanbanData = JSON.parse(decodeBase64(json.content));
            setLoading(90);
        } else {
            kanbanData = EMBEDDED_DATA;
        }
    } catch(e) {
        kanbanData = EMBEDDED_DATA;
    }
    render();
    setLoading(100);
    setTimeout(function() {
        document.getElementById('loading-bar').style.display = 'none';
    }, 400);
}

function decodeBase64(str) {
    return decodeURIComponent(escape(atob(str.replace(/\n/g, ''))));
}

function getAuthHeaders() {
    var pat = localStorage.getItem('demko_github_pat');
    if (pat) return { 'Authorization': 'token ' + pat };
    return {};
}

function setLoading(pct) {
    document.getElementById('loading-bar').style.width = pct + '%';
}

// â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(text) {
    if (!text) return '';
    var d = document.createElement('div');
    d.textContent = text;
    return d.innerHTML;
}

function render() {
    var data = kanbanData;
    var meta = data.meta;
    var cards = data.cards;
    var columns = data.columns;
    var rate = meta.hourly_rate || 250;

    // Stats
    var nCritical = 0, nPending = 0, nDone = 0, totalHours = 0;
    cards.forEach(function(c) {
        if (c.column === 'done') nDone++;
        else if (c.column === 'critical') nCritical++;
        else nPending++;
        totalHours += (c.hours_saved || 0);
    });
    var nTotal = cards.length;
    var hoursStr = totalHours === Math.floor(totalHours) ? Math.floor(totalHours) + 'h' : totalHours + 'h';
    var totalValue = totalHours * rate;
    var valueStr = totalValue >= 1000 ? '$' + (totalValue / 1000).toFixed(1) + 'k' : '$' + Math.floor(totalValue);

    var hasPAT = !!localStorage.getItem('demko_github_pat');
    var gearClass = hasPAT ? 'settings-gear connected' : 'settings-gear';

    var html = '';

    // Top bar
    html += '<div class="topbar">';
    html += '  <div class="topbar-left">';
    html += '    <div class="logo">D</div>';
    html += '    <h1>' + esc(meta.title) + '</h1>';
    html += '    <span class="session-tag">' + esc(meta.session_tag) + '</span>';
    html += '  </div>';
    html += '  <div class="topbar-right">';
    html += '    <div class="topbar-stat"><div class="val val-critical" id="stat-critical">' + nCritical + '</div><div class="lbl">Critical</div></div>';
    html += '    <div class="topbar-stat"><div class="val val-pending" id="stat-pending">' + nPending + '</div><div class="lbl">Pending</div></div>';
    html += '    <div class="topbar-stat"><div class="val val-done" id="stat-done">' + nDone + '</div><div class="lbl">Done</div></div>';
    html += '    <div class="topbar-stat"><div class="val val-total" id="stat-total">' + nTotal + '</div><div class="lbl">Total</div></div>';
    html += '    <div class="topbar-divider"></div>';
    html += '    <div class="topbar-stat"><div class="val val-saved" id="stat-hours">' + hoursStr + '</div><div class="lbl">Hrs Saved</div></div>';
    html += '    <div class="topbar-stat"><div class="val val-saved" id="stat-value">' + valueStr + '</div><div class="lbl">@ $' + rate + '/hr</div></div>';
    html += '    <div class="topbar-divider"></div>';
    html += '    <div class="' + gearClass + '" onclick="openSettings()" title="GitHub Connection">' + (hasPAT ? '&#9889;' : '&#9881;') + '</div>';
    html += '  </div>';
    html += '</div>';

    // Main content
    html += '<div class="main">';

    // Banners
    if (data.banners && data.banners.priority) {
        html += '<div class="priority-banner"><div class="icon">!</div><div class="text">' + data.banners.priority + '</div></div>';
    }
    if (data.banners && data.banners.parallel) {
        html += '<div class="parallel-bar"><div class="icon">||</div><div><strong>Run up to 5 tasks in parallel</strong> on claude.ai. Click &ldquo;Launch&rdquo; to copy the task prompt and open a new Claude tab. Paste (Ctrl+V) and hit Enter. Each runs independently.</div></div>';
    }

    // Search bar
    html += '<div class="search-bar">';
    html += '  <span class="search-icon">&#128269;</span>';
    html += '  <input type="text" id="search-input" placeholder="Search tasks..." oninput="filterCards(this.value)">';
    html += '  <button class="search-clear" id="search-clear" onclick="clearSearch()">&#10005;</button>';
    html += '</div>';

    // Sections
    columns.forEach(function(col) {
        var colCards = cards.filter(function(c) { return c.column === col.id; });
        if (colCards.length === 0) return;
        var isDone = col.id === 'done';

        html += '<div class="section-header">';
        html += '  <div class="section-dot ' + col.dot + '"></div>';
        html += '  <h2>' + esc(col.label) + '</h2>';
        html += '  <span class="count-badge">' + colCards.length + '</span>';
        if (isDone) html += '  <button class="toggle-btn" id="leaderboard-toggle" onclick="toggleLeaderboard()">Leaderboard</button>';
        html += '  <div class="section-line"></div>';
        html += '</div>';

        var gridId = isDone ? ' id="done-grid"' : '';
        var DONE_VISIBLE = 10;
        html += '<div class="card-grid"' + gridId + '>';
        if (isDone && colCards.length > DONE_VISIBLE) {
            // Show only last N (most recent = end of array)
            var hidden = colCards.slice(0, colCards.length - DONE_VISIBLE);
            var visible = colCards.slice(colCards.length - DONE_VISIBLE);
            hidden.forEach(function(card) {
                html += renderCard(card).replace('class="card ', 'class="card done-collapsed ');
            });
            visible.forEach(function(card) {
                html += renderCard(card);
            });
            html += '</div>';
            html += '<button class="done-expander" id="done-expander" onclick="toggleDoneCollapse()">Show ' + hidden.length + ' more completed tasks</button>';
        } else {
            colCards.forEach(function(card) {
                html += renderCard(card);
            });
            html += '</div>';
        }
    });

    html += '</div>'; // main

    // Footer
    html += '<div class="footer"><span>Last updated: ' + esc(meta.last_updated) + ' &middot; ' + esc(meta.title) + ' 2 &middot; CI: ' + esc(meta.ci_status) + '</span></div>';

    document.getElementById('app').innerHTML = html;
}

var TAG_CLASSES = { protocol: 'tag-protocol', setup: 'tag-setup', build: 'tag-build', infra: 'tag-infra', cleanup: 'tag-cleanup' };
var CARD_CLASSES = { done: 'card-done', critical: 'card-critical', high: 'card-high', medium: 'card-medium', low: 'card-low' };
var CHIP_MAP = { critical: ['chip-critical','Critical'], high: ['chip-high','High'], medium: ['chip-medium','Medium'], low: ['chip-low','Backlog'] };

function renderCard(card) {
    var p = card.priority;
    var cls = CARD_CLASSES[p] || 'card-low';
    var hoursAttr = card.hours_saved != null ? ' data-hours="' + card.hours_saved + '"' : '';
    var h = '';

    h += '<div class="card ' + cls + '" data-id="' + card.id + '"' + hoursAttr + '>';
    h += '  <div class="card-top">';
    h += '    <h3>' + esc(card.title) + '</h3>';
    h += '    <div class="card-chips">';

    if (card.overnight) h += '<span class="overnight-badge">&#127769; Overnight</span>';
    if (card.hours_saved != null) {
        var hs = card.hours_saved === Math.floor(card.hours_saved) ? Math.floor(card.hours_saved) : card.hours_saved;
        h += '<span class="time-saved">&#9201; Saved ~' + hs + ' hrs</span>';
    }
    if (p === 'done') {
        h += '<span class="priority-chip chip-done">Done</span>';
    } else {
        if (card.time_estimate) h += '<span class="time-chip">' + esc(card.time_estimate) + '</span>';
        var chip = CHIP_MAP[p] || ['chip-low', 'Backlog'];
        h += '<span class="priority-chip ' + chip[0] + '">' + chip[1] + '</span>';
    }

    h += '    </div>';
    h += '  </div>';
    h += '  <div class="card-desc" id="desc-' + card.id + '">' + esc(card.description) + '</div>';
    var descLen = (card.description || '').length;
    h += '  <button class="show-more' + (descLen > 120 ? ' visible' : '') + '" id="more-' + card.id + '" onclick="toggleDesc(\'' + card.id + '\')">Show more</button>';
    h += '  <div class="card-footer">';
    h += '    <div class="card-tags">';
    (card.tags || []).forEach(function(tag) {
        var tc = TAG_CLASSES[tag] || 'tag-build';
        h += '<span class="tag ' + tc + '">' + tag.charAt(0).toUpperCase() + tag.slice(1) + '</span>';
    });
    h += '    </div>';

    // Action buttons
    if (card.column !== 'done') {
        h += '<div style="display:flex;gap:0.4rem;align-items:center">';
        if (card.needs_user) {
            h += '<span class="needs-user">' + esc(card.needs_user) + '</span>';
        }
        if (card.launch_prompt) {
            h += '<button class="launch-btn" onclick="launchTask(this,\'' + card.id + '\')">&#8599; Launch</button>';
        }
        h += '<button class="complete-btn" onclick="openCompleteModal(\'' + card.id + '\')">&#10003; Done</button>';
        h += '</div>';
    } else if (card.needs_user) {
        h += '<span class="needs-user">' + esc(card.needs_user) + '</span>';
    }

    h += '  </div>';

    if (card.chains && card.chains.length) {
        h += '<div class="unlocked-chain">';
        card.chains.forEach(function(chain) {
            h += '<span class="chain-arrow">&rarr; ' + esc(chain) + '</span>';
        });
        h += '</div>';
    }

    h += '</div>';
    return h;
}

// â”€â”€ Complete Task Flow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openCompleteModal(cardId) {
    completingCardId = cardId;
    var card = kanbanData.cards.find(function(c) { return c.id === cardId; });
    if (!card) return;
    document.getElementById('complete-modal-title').textContent = 'Complete: ' + card.title;
    document.getElementById('complete-modal-subtitle').textContent = card.description.substring(0, 100) + (card.description.length > 100 ? '...' : '');
    document.getElementById('hours-input').value = '1';
    document.querySelectorAll('.hours-presets button').forEach(function(b) { b.classList.remove('selected'); });
    document.getElementById('complete-overlay').classList.add('open');
}

function closeCompleteModal() {
    document.getElementById('complete-overlay').classList.remove('open');
    completingCardId = null;
}

function selectHours(h) {
    document.getElementById('hours-input').value = h;
    document.querySelectorAll('.hours-presets button').forEach(function(b) {
        b.classList.toggle('selected', parseFloat(b.textContent) === h);
    });
}

async function confirmComplete() {
    if (!completingCardId) return;
    var hours = parseFloat(document.getElementById('hours-input').value) || 0;
    var card = kanbanData.cards.find(function(c) { return c.id === completingCardId; });
    if (!card) return;

    // Update local state
    card.column = 'done';
    card.priority = 'done';
    card.hours_saved = hours;

    // Update timestamp
    var now = new Date();
    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    card.description += ' Completed ' + months[now.getMonth()] + ' ' + now.getDate() + '.';

    closeCompleteModal();
    render();
    showToast('Marked "' + card.title + '" as done! (' + hours + 'h saved)');

    // Persist to GitHub
    await pushToGitHub('Complete: ' + card.title + ' (' + hours + 'h saved)');
}

// â”€â”€ GitHub Persistence â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function pushToGitHub(commitMsg) {
    var pat = localStorage.getItem('demko_github_pat');
    if (!pat) {
        showToast('Change saved locally. Connect GitHub in Settings to persist.');
        return;
    }
    if (!fileSha) {
        // Need to get current SHA first
        try {
            var resp = await fetch(
                'https://api.github.com/repos/' + GITHUB_OWNER + '/' + GITHUB_REPO +
                '/contents/' + GITHUB_PATH + '?ref=' + GITHUB_BRANCH,
                { headers: { 'Authorization': 'token ' + pat } }
            );
            if (resp.ok) {
                var json = await resp.json();
                fileSha = json.sha;
            }
        } catch(e) {
            showToast('Could not reach GitHub API');
            return;
        }
    }

    try {
        var content = btoa(unescape(encodeURIComponent(JSON.stringify(kanbanData, null, 2) + '\n')));
        var resp = await fetch(
            'https://api.github.com/repos/' + GITHUB_OWNER + '/' + GITHUB_REPO +
            '/contents/' + GITHUB_PATH,
            {
                method: 'PUT',
                headers: {
                    'Authorization': 'token ' + pat,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: commitMsg || 'Dashboard update',
                    content: content,
                    sha: fileSha,
                    branch: GITHUB_BRANCH
                })
            }
        );
        if (resp.ok) {
            var json = await resp.json();
            fileSha = json.content.sha;
            showToast('Pushed to GitHub!');
        } else {
            var err = await resp.json();
            showToast('GitHub error: ' + (err.message || resp.status));
        }
    } catch(e) {
        showToast('Push failed: ' + e.message);
    }
}

// â”€â”€ Settings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openSettings() {
    document.getElementById('pat-input').value = localStorage.getItem('demko_github_pat') || '';
    document.getElementById('settings-overlay').classList.add('open');
}
function closeSettings() {
    document.getElementById('settings-overlay').classList.remove('open');
}
function savePAT() {
    var val = document.getElementById('pat-input').value.trim();
    if (val) {
        localStorage.setItem('demko_github_pat', val);
        showToast('GitHub token saved. Complete buttons will now persist changes.');
    }
    closeSettings();
    render();
}
function clearPAT() {
    localStorage.removeItem('demko_github_pat');
    showToast('GitHub token cleared.');
    closeSettings();
    render();
}

// â”€â”€ Launch Task â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function launchTask(btn, cardId) {
    var card = kanbanData.cards.find(function(c) { return c.id === cardId; });
    if (!card || !card.launch_prompt) return;
    var encoded = encodeURIComponent(card.launch_prompt);
    window.location.href = 'claude-code://launch?prompt=' + encoded;
    btn.classList.add('launched');
    btn.innerHTML = '&#10003; Launched';
    showToast('Opening Claude Code CLI...');
}

// â”€â”€ Leaderboard Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleLeaderboard() {
    var grid = document.getElementById('done-grid');
    var btn = document.getElementById('leaderboard-toggle');
    if (!grid || !btn) return;
    var cards = Array.from(grid.children);

    if (!leaderboardActive) {
        cards.sort(function(a, b) {
            return parseFloat(b.dataset.hours || 0) - parseFloat(a.dataset.hours || 0);
        });
        cards.forEach(function(card, i) {
            var rank = document.createElement('div');
            rank.className = 'leaderboard-rank';
            rank.textContent = '#' + (i + 1);
            card.appendChild(rank);
            if (i < 3) card.style.opacity = '0.9';
            var chain = card.querySelector('.unlocked-chain');
            if (chain) chain.style.display = 'none';
        });
        cards.forEach(function(c) { grid.appendChild(c); });
        btn.classList.add('active');
        btn.textContent = 'Chronological';
        leaderboardActive = true;
    } else {
        cards.forEach(function(card) {
            var rank = card.querySelector('.leaderboard-rank');
            if (rank) rank.remove();
            card.style.opacity = '';
            var chain = card.querySelector('.unlocked-chain');
            if (chain) chain.style.display = '';
        });
        btn.classList.remove('active');
        btn.textContent = 'Leaderboard';
        leaderboardActive = false;
        render(); // re-render to restore original order
    }
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg) {
    var t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(function() { t.classList.remove('show'); }, 4000);
}

// â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function filterCards(query) {
    var clearBtn = document.getElementById('search-clear');
    if (clearBtn) clearBtn.classList.toggle('visible', query.length > 0);
    var q = query.toLowerCase().trim();
    var allCards = document.querySelectorAll('.card');
    allCards.forEach(function(el) {
        var title = (el.querySelector('h3') || {}).textContent || '';
        var desc = (el.querySelector('.card-desc') || {}).textContent || '';
        var tags = Array.from(el.querySelectorAll('.tag')).map(function(t) { return t.textContent; }).join(' ');
        var match = !q || title.toLowerCase().indexOf(q) >= 0 || desc.toLowerCase().indexOf(q) >= 0 || tags.toLowerCase().indexOf(q) >= 0;
        el.classList.toggle('search-hidden', !match);
    });
    document.querySelectorAll('.section-header').forEach(function(hdr) {
        var grid = hdr.nextElementSibling;
        if (!grid || !grid.classList.contains('card-grid')) return;
        var visibleCards = grid.querySelectorAll('.card:not(.search-hidden)');
        hdr.classList.toggle('search-hidden', visibleCards.length === 0);
        grid.classList.toggle('search-hidden', visibleCards.length === 0);
    });
}
function clearSearch() {
    var input = document.getElementById('search-input');
    if (input) { input.value = ''; filterCards(''); input.focus(); }
}

// â”€â”€ Desc Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleDesc(cardId) {
    var desc = document.getElementById('desc-' + cardId);
    var btn = document.getElementById('more-' + cardId);
    if (!desc || !btn) return;
    var expanded = desc.classList.toggle('expanded');
    btn.textContent = expanded ? 'Show less' : 'Show more';
}

// â”€â”€ Done Collapse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleDoneCollapse() {
    var collapsed = document.querySelectorAll('.done-collapsed');
    var btn = document.getElementById('done-expander');
    if (!btn) return;
    var showing = collapsed.length > 0 && collapsed[0].classList.contains('show-all');
    collapsed.forEach(function(el) { el.classList.toggle('show-all', !showing); });
    btn.textContent = showing
        ? 'Show ' + collapsed.length + ' more completed tasks'
        : 'Show less';
}

// â”€â”€ Go â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
init();
</script>
</body>
</html>